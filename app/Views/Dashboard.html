{% include 'header_full.html' %}
{% include 'menu.html' %}

<div class="container">
	<div id="page-wrapper dashboard" style="min-height: 129px;">
		<div class="row">
		    <div class="col-lg-12">
		        <h1 class="page-header">Estadísticas</h1>
		    </div>
		</div>

		<div class="row">
			<div class="col-xs-12">
				<div class="row">
					<div class='col-xs-1'>
						Desde
					</div>
					<div class='col-xs-3'>
						<div class="form-group">
						<div class='input-group date' id='fecha-inicio'>
						<input type='text' class="form-control" id="fechaInicio" />
						<span class="input-group-addon">
						<span class="glyphicon glyphicon-calendar"></span>
						</span>
						</div>
						</div>
					</div>
					<div class='col-xs-1'>
						Hasta
					</div>
					<div class='col-xs-3'>
						<div class="form-group">
						<div class='input-group date' id='fecha-fin'>
						<input type='text' class="form-control" id="fechaFin" />
						<span class="input-group-addon">
						<span class="glyphicon glyphicon-calendar"></span>
						</span>
						</div>
						</div>
					</div>
					<div class='col-xs-4'>
						<button type="button" class="btn btn-success" onclick="filtrar()">Filtrar</button>
					</div>
				</div>
			</div>
		</div>

		<div class="row">
			{% for panel in paneles %}
			<div class="col-lg-3 col-md-6">
				<div class="panel dashboard_{{ panel.llave }}">
					<div class="panel-heading">
						<div class="row">
							<div class="col-xs-3">
								<i class="fa {{ panel.icono }} fa-5x"></i>
							</div>
							<div class="col-xs-9 text-right">
								<div class="huge">Registros: {{ panel.data.REGISTROS|e }} Por: ${{ panel.data.IMPORTE|number_format(2, '.', ',') }}</div>
								<div>{{ panel.titulo|e }}</div>
								<div class="dashboard_more">
									<a href="#" onclick="javascript: muestraDetalle( '{{ panel.llave }}', '{{panel.titulo}}' )"><i class="fa fa-eye"></i>Ver más</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			{% endfor %}
		</div>
	</div>
</div>

<div id="modal" class="modal fade">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 id="modal-titulo" class="modal-title">Detalle</h4>
			</div>
			<div class="modal-body">
				<table id="panel-detalle"></table>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">

function filtrar() {
	jQuery.redirect('{{constant('BASE_URL')}}dashboard', { 'fechaInicio': $('#fechaInicio').val(), 'fechaFin': $('#fechaFin').val() });
}

function muestraDetalle( panel, titulo ) {
	var cols = false
	var data = false
	
	loader.show()

	$( '#panel-detalle' ).bootstrapTable( 'destroy' )
	$( '#modal-titulo' ).html( 'Detalle ' + titulo )
	
	jQuery.ajax({
		url: '{{constant('BASE_URL')}}dashboard/apidetallepanelcols',
		data: { panel:panel },
		method: 'POST',
		async: false,
		success: function (result) {
			cols = result
		},
		async: false
	})

	$( '#panel-detalle' ).bootstrapTable({
		method: 'get',
		url: '{{constant('BASE_URL')}}dashboard/apidetallepanel/panel/' + panel,
		columns: cols,
		height: 600,
		striped: true,
		pagination: true,
		pageSize: 25,
		pageList: [10, 25, 50, 100, 200],
		search: true,
		showColumns: true,
		showRefresh: true,
		showExport: true,
		mobileResponsive: true,
		minimumCountColumns: 2
	})

	$( '#modal' ).modal('show')

	loader.hide()
}

$(function () {
	$('#fecha-fin').datetimepicker({
		format: 'DD/MM/YYYY'
	});
	$('#fecha-inicio').datetimepicker({
		useCurrent: true,
		format: 'DD/MM/YYYY'
	});
	$("#fecha-inicio").on("dp.change", function (e) {
		$('#fecha-fin').data("DateTimePicker").minDate(e.date);
		$('#fecha-fin').data("DateTimePicker").date(e.date);
	});
	$("#fecha-fin").on("dp.change", function (e) {
		$('#fecha-inicio').data("DateTimePicker").maxDate(e.date);
	});
});

</script>

{% include 'footer_full.html' %}